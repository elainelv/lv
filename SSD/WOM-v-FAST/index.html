<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="keyword"  content="">
    <link rel="shortcut icon" href="/lv/img/favicon-32x32-next.ico">
    <!-- Place this tag in your head or just before your close body tag. -->
    <script async defer src="https://buttons.github.io/buttons.js"></script>
    <title>
        
          Improving the Reliability of Next Generation SSDs using WOM-v Codes - ElaineLv | Blog
        
    </title>

    <link rel="canonical" href="http://elainelv.com/lv/SSD/WOM-v-FAST/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/lv/css/bootstrap.min.css">

    <!-- Custom CSS --> 
    <link rel="stylesheet" href="/lv/css/beantech.min.css">

    <link rel="stylesheet" href="/lv/css/donate.css">
    
    <!-- Pygments Highlight CSS -->
    <link rel="stylesheet" href="/lv/css/highlight.css">

    <link rel="stylesheet" href="/lv/css/widget.css">

    <link rel="stylesheet" href="/lv/css/rocket.css">

    <link rel="stylesheet" href="/lv/css/signature.css">

    <link rel="stylesheet" href="/lv/css/toc.css">

    <!-- Custom Fonts -->
    <!-- <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"> -->
    <!-- Hux change font-awesome CDN to qiniu -->
    <link href="https://cdn.staticfile.org/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">


    <!-- Hux Delete, sad but pending in China
    <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/
    css'>
    -->


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- ga & ba script hoook -->
    <script></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head>


<!-- hack iOS CSS :active style -->
<body ontouchstart="">
	<!-- hexo-inject:begin --><!-- hexo-inject:end --><!-- Modified by Yu-Hsuan Yen -->
<!-- Post Header -->
<style type="text/css">
    header.intro-header{
        
            background-image: url('/lv/img/article_header/passd_bg.png')
            /*post*/
        
    }
    
    #signature{
        background-image: url('/lv/lv/img/signature/BeanTechSign-white.png');
    }
    
</style>

<header class="intro-header" >
    <!-- Signature -->
    <div id="signature">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                
                    <div class="post-heading">
                        <div class="tags">
                            
                              <a class="tag" href="/lv/tags/#Lifetime" title="Lifetime">Lifetime</a>
                            
                              <a class="tag" href="/lv/tags/#QLC" title="QLC">QLC</a>
                            
                              <a class="tag" href="/lv/tags/#WOM" title="WOM">WOM</a>
                            
                        </div>
                        <h1>Improving the Reliability of Next Generation SSDs using WOM-v Codes</h1>
                        <h2 class="subheading"></h2>
                        <span class="meta">
                            Posted by Yina Lv on
                            2022-04-26
                        </span>
                    </div>
                


                </div>
            </div>
        </div>
    </div>
</header>

	
    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/lv/">ElaineLv</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <!-- Known Issue, found by Hux:
            <nav>'s height woule be hold on by its content.
            so, when navbar scale out, the <nav> will cover tags.
            also mask any touch event of tags, unfortunately.
        -->
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/lv/">Home</a>
                    </li>

                    

                        
                    

                        
                    

                        
                        <li>
                            <a href="/lv/archive/">Archives</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/lv/tags/">Tags</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/lv/recommend/">Recommend</a>
                        </li>
                        
                    
                    
                </ul>
            </div>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>
<script>
    // Drop Bootstarp low-performance Navbar
    // Use customize navbar with high-quality material design animation
    // in high-perf jank-free CSS3 implementation
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        // CLOSE
            $navbar.className = " ";
            // wait until animation end.
            setTimeout(function(){
                // prevent frequently toggle
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        // OPEN
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>


    <!-- Main Content -->
    <!-- Modify by Yu-Hsuan Yen -->

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

            <!-- Post Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                <h2 id="引子"><a href="#引子" class="headerlink" title="引子"></a>引子</h2><p>本工作来自多伦多大学和谷歌合作<a href="https://www.cs.toronto.edu/~shehbaz/cv.pdf" target="_blank" rel="noopener">Shehbaz Jaffer</a>，发表于FAST 2022，<code>Best Paper</code>。<strong><code>作者测试发现binary-WOM编码下，存储元中比特数量与其能够支持的重编程次数成反比关系。存储元每多增加一个比特，可实现的重编程次数少一个数量级。</code></strong> 为了解决下一代高密度闪存低耐久性带来的可靠性挑战，提出新的编码WOM-v (Voltage-based Write-Once-Memory)，来提高SSD的使用寿命。通过重编程的方式，增加擦除操作间的编程次数来应对高密度闪存有限擦除次数的瓶颈问题。<br>先前该团队已从理论上验证WOM-v的可行性 <a href="https://www.usenix.org/system/files/hotstorage20_paper_jaffer.pdf" target="_blank" rel="noopener">HotStorage 2020</a>。本文的贡献是证明WOM-v码在实践中具有真正的收益。考虑SSD中的垃圾回收过程、评估性能以及不同负载特征下的改进效果。并证明了使用WOM-v码来减少SSD的擦除次数在理论和实践上存在差异。发现对于高写放大的工作负载，高阶WOM-v码（e.g., WOM-v(1,4)）不会减少擦除次数。针对此问题，进一步提出两种优化方法，GC-OPT和NR模式，它们在保持高性能的同时显著减少了擦除操作。<br>本文基于<strong>FEMU+LightNVM</strong>平台，实现WOM-v码，并基于FEMU实现QLC模拟。展示如何通过以可忽略的性能开销提高QLC闪存的寿命4.4x-11.1x。<br>WOM-v开源代码: <a href="https://github.com/uoftsystems/womv。" target="_blank" rel="noopener">https://github.com/uoftsystems/womv。</a></p>
<hr>
<p><a href="https://www.usenix.org/conference/fast22/presentation/jaffer" target="_blank" rel="noopener">Improving the Reliability of Next Generation SSDs using WOM-v Codes</a></p>
<h2 id="背景amp问题"><a href="#背景-amp-问题" class="headerlink" title="背景&amp;问题"></a>背景&amp;问题</h2><p>随着闪存密度的增加，其可承受的擦除次数逐渐减少。如下图所示。QLC的擦除次数不到1000次，而PLC仅为几十至几百次。特别是存储元尺寸小，擦除次数就更少了。针对这个问题，本文将从WOM编码的角度探索如何通过增加重编程次数来降低擦除次数。下面首先讨论传统binary-WOM码的原理及缺陷。</p>
<p><img src="/lv/img/article/WOM-v-FAST/WOM-v-FAST_a.png" alt=""></p>
<h3 id="binary-wom-codes"><a href="#Binary-WOM-codes" class="headerlink" title="Binary-WOM codes"></a>Binary-WOM codes</h3><p>Binary-WOM应用于较早的存储设备上，例如Punch Card。在这类介质上，数据以位为粒度写入，并且一旦写入，位只能在一个方向上更改。例如，只能从比特0变换到比特1。表1和表2给出的是WOM(2,3)和WOM(2,4)，对于WOM(2,3)，表示数据存储两位，但实际存储三位。可以看作底层是TLC闪存，抽象出MLC闪存。对于每个TLC页面，可以编程两次(两代)。第一代和第二代中的比特位是TLC三位组成的8种形式。因此，通过这种方式，两次编程后，实际写入的数据为2+2=4bits,比TLC的3bits要多。</p>
<p><img src="/lv/img/article/WOM-v-FAST/WOM-v-FAST_1.png" alt=""></p>
<p>然而，Binary-WOM不适合新一代的闪存，如QLC。对于闪存存储元的真正限制是，电压值总是增加(达到最大电压Vmax)，但不能降低，这与编码的位值无关。坚持采用二进制模型会产生不必要的约束。<br>经过作者的测试发现，存储元中比特数量与其能够支持的重编程次数成反比关系。存储元每多增加一个比特，可实现的重编程次数少一个数量级。因此，WOM码本身的写放大，对QLC使用binary-WOM没有净增益。</p>
<h2 id="wom-v-code"><a href="#WOM-v-Code" class="headerlink" title="WOM-v Code"></a>WOM-v Code</h2><p>为了解决上述问题，本文设计了新的编码<code>WOM-v (Voltage-based Write-Once-Memory)</code>，实现更高的写入量。WOM-v码借助于闪存编程的特征(往存储元中存储电荷)。编程以ISPP方式总是由低电压编程到高电压。因此，可以将电压分布范围划分成多个GEN，一个GEN中包含的电压区间表示一次编程可以到达的电压值。以QLC为例，存储元中存储4个比特，可以形成16种电压状态（V0-V16）。如下图所示，可以有WOM-v(3,4), WOM-v(2,4), WOM-v(1,4)。事实上，WOM-v(3,4)就是将QLC看作TLC使用，用户存储3个数据字，而实际存储4位码字。由于每次表示3位，因此单次编程只需要8个状态。这样QLC的16个状态就可以编程两次。更高阶WOM-v(2,4)则可以编程16/4=4次。</p>
<p><img src="/lv/img/article/WOM-v-FAST/WOM-v-FAST_2.png" alt=""></p>
<p>基于上述思想，有以下几个优化点：</p>
<ul>
<li><strong>同代转换：</strong> 是指重编程后，存储元的电压状态还在同个GEN中。具体来说，在编程时，若编程后的DATA可以用当前电压值和当前GEN的最大电压值之间的电压状态表示时，同一个GEN内部也可以重编程。例如，当前是001(V1)，编程后为101。那么无需进入GEN2，编程到GEN1中的V5即可，并做好记录；—》此优化点的问题是会产生写前读，每次重编程之前需要通过一次读取来确定存储元的电压状态。本文进一步提出NR模式来权衡是否采取此优化点。</li>
<li><strong>码字共享：</strong> WOM-v(3,4)中的电压状态V7在GEN1和GEN2之间是共享的。数据111在GEN1和GEN2中都映射到V7。这种共享让我们可以挤出更多的重编程代数。例如，WOM-v(2,4)原先是4代，共享后为5代。</li>
<li><strong>利用ECC容错空间：</strong> 当写发生在页面的粒度(而不是存储元)上时，一旦页面的任何一个存储元达到GEN_MAX，就不能再重编程。<strong><code>当页面中少量存储元达到GEN_MAX的情况下，继续进行页面重编程而不擦除</code></strong>。要实现上述目标，可以利用设备中的ECC纠错码的容错空间。通过标记少量已达到GEN_MAX的存储元为无效，剩余存储元组成的页面可继续执行重编程。而这些标记无效的存储元的值可以通过现有ECC来确定。</li>
</ul>
<p><img src="/lv/img/article/WOM-v-FAST/WOM-v-FAST_b.png" alt=""></p>
<p><strong>使用现有的ECC重新构建标记为无效的存储元内容是否会影响设备的可靠性或性能？</strong><br>1）ECC一般是过度配置的(在SSD使用末期依然需要保障数据正确纠错)。因此，在设备运行的头几年，当误码率低于ECC可纠错值时，ECC可以处理一定数量的无效存储元，而不会对可靠性产生任何影响。为了控制对可靠性的影响，允许标记为无效的存储元设置一个阈值<code>ECC_threshold</code>。如果页面中达到GEN_MAX的存储元数量超过ECC_threshold，则不允许进一步覆盖写，需要先擦除页面。在实践中，ECC_threshold可以根据闪存年龄或观察到的误码率进行动态选择。本文将ECC_threshold设置为3%。这个阈值的选择是基于[12]中的理论评估，并结合当前设备在每页中报告了7%的ECC错误的事实。预测将为QLC和未来一代设备保留更高的ECC。<br>2）ECC往往用于处理随机比特错误。而无效存储元的位置是已知的，因此恢复无效存储元的值更容易。ECC只需要执行correction，而不是detection和correction。</p>
<blockquote>
<p><strong>WOM-v码具有闪存友好型</strong><br>1）只涉及短电压水平范围内的电压状态变化。与NO-WOM相比，向每个存储元中注入的电荷量更少。在编程单元和邻近存储元中诱导更少的编程干扰错误；<br>2）缓慢的电压增量也可以简化SSD电路。</p>
</blockquote>
<p><strong>“</strong> 读到这里，可能有读者和我一样，WOM-v码的重编程是在一个Page上对数据多次就地更新吗？这样会不会造成严重的字线间干扰呢？这样的话，问题也太严重了叭@_@ ——答案：不是就地重编程！！对于数据更新，则是更新到当前打开的EU。对于GC，在回收有效页面后，不执行擦除，闪存块可直接拿来重编程直到达到GEN_MAX。<strong>”</strong></p>
<hr>
<h2 id="系统实现"><a href="#系统实现" class="headerlink" title="系统实现"></a>系统实现</h2><p>本文在Linux LightNVM Open-Channel SSD子系统模块中实现了WOM-v码，它允许在FTL中进行更改。并扩展FEMU来模拟QLC设备。通过WOM-v的系统实现，可以测试在SSD中实际减少的擦除次数(以EU为粒度执行擦除操作)，以及评估在理论上无法准确收集的<code>input data contents</code>、<code>workload patterns</code>和<code>performance overhead</code>。</p>
<p><strong>LightNVM架构</strong><br>LightNVM是一个Linux模块，它向主机公开了NVMe SSD的底层体系结构。有助于对读写方式进行修改，也能够控制垃圾回收，以及何时应该在底层设备上执行擦除操作。LightNVM的内部体系结构如图3所示。LightNVM模块的两个主要数据结构是1) Ring Buffer和2) Parallel Units。</p>
<p><img src="/lv/img/article/WOM-v-FAST/WOM-v-FAST_3.png" alt=""></p>
<!--
**Ring Buffer：** 是一个循环缓冲区，用于存放主机端写入的数据和GC回收的有效数据。其可以通过应用程序直接访问，也可以通过文件系统访问。一旦缓冲区已满或用户发送一个sync同步操作，缓冲区的数据将按循环顺序在不同的并行单元之间进行条带化。环缓冲区是两个线程（user-write thread和gc thread）之间的共享资源，用户写线程将传入的应用程序/文件系统数据复制到环缓冲区，GC线程在垃圾回收期间将有效的页面从底层设备复制到环缓冲区。在NO-WOM和WOM-v(k,N)中，环形缓冲区和设备配置保持不变。
**Parallel Units：** 上图表示一个具有4个并行单元的设备。并行单元(PU)是设备上的独立存储单元。每个并行单元被分为多个擦除块。每个块包含一个线性的页面数组，可以从块的第一页到最后一页依次编程。每个并行单元相同位置的块组合起来形成一个擦除单元(EU)。在一个EU内部，跨数据块的页面是并行编程的。
**写入操作：** 所有页面写入都在环缓冲区上进行。如果环缓冲区中可用的数据很小，并且用户发出sync同步命令，则要写入的数据将被适当填充以对齐并跨并行单元进行条带。在任何时候都会有一个EU（active EU）服务于写操作。EU的所有块同时被填满。一旦active EU被填满，当前EU就会关闭，新的EU就会被激活，服务于未来的写。
**读取操作：** 通过bio请求发送到设备。LightNVM模块首先使用逻辑到物理（L2P）地址映射，将页面请求的逻辑块地址(LBA)转换为设备物理页地址(PPA)。然后，将页面内容从设备PPA复制到bio请求中，并返回给用户。
**垃圾回收：** LightNVM使用垃圾回收来回收被无效页面所占用的空间。页面要么被TRIM命令显式无效，要么因为存储在其中的逻辑页面被应用程序更新。为了释放这些被无效数据占用的页面，gc-thread在gc-mode下打开一个关闭的EU以进行垃圾回收。在垃圾回收阶段，gc-erase-unit的所有有效页面都被复制到环缓冲区。整个EU被擦除并关闭。这个EU被返回到可用的空闲池中，供用户写线程打开使用。LightNVM采用了一种贪婪的方法来选择一个要被垃圾回收的EU，优先选择具有最多无效页面数的EU。LightNVM保留了11%的ops空间。此外，LightNVM没有均衡磨损机制，将均衡磨损委托到设备FTL。
-->
<p><strong>基于LightNVM的WOM-v code实现</strong><br>要将WOM-v码合并到LightNVM代码中，需要做以下更改：<br>1）对设备的所有写入操作都需要进行编码。<br>2）发布给设备的所有读取都需要解码以前编写的数据。<strong><code>编码和解码涉及到简单的表查找</code></strong><br>3）需要修改默认的垃圾回收逻辑。与其在垃圾回收过程中擦除所有的EU，现在应该根据EU内部页面的状态（是否达到GEN_MAX）有选择地进行擦除。<br>4）底层设备模拟器需要支持下一代具有QLC或更密集的闪存介质的SSD设备。<br>5）本文进一步实现了两种优化，GC_OPT和NR模式，有助于提高性能和减少WOM-v的开销。</p>
<p><strong>基本实现</strong><br>将以下组件添加到LightNVM模块中（在图3中以绿色突出显示）：1) 编码和解码逻辑；2) WOM-v感知的垃圾收集逻辑；3) 基于FEMU的QLC支持。<br><strong>1. 写入操作：</strong> 所有写数据在写入设备之前都进行编码。默认情况下，WOM编码首先读取设备上先前写入的数据（查看当前编程到哪一代了）。该数据在物理页面上进行编码和覆盖，以维护底层介质基于电压的约束。由于这种默认方法会导致读放大。<br>在将环形缓冲区数据写入设备之前，在环形缓冲区中暂存页面的逻辑块地址(LBA)与设备物理页地址(PPA)之间创建一个映射。在此阶段，拦截所有的写操作，并执行以下转换：1）对正在写入的所有页面的PPA中读取预先存在的编码数据；2）使用现有的数据对页面进行再编码；3）将新的编码页面写入设备。<br><strong>2. 读取操作：</strong> 所有被读取的编码页面都在读取返回路径中被解码。解码后的数据被复制到最初提交的bio请求中，并且可以被应用程序读取而无需修改。<br><strong>3. 垃圾回收：</strong> 传统的GC是回收有效页面后直接擦除才能使用，然而本文使用的WOM-v码下，页面可重编程。因此只有当EU中任何一个页面达到最大可重编程次数后才会被擦除。所以每次GC只需要回收有效页面而不需要执行擦除操作。<br><strong>4. Cell and Page Layout：</strong> 除了前面提到的数据编码外，我们还改变了存储元分配给页面的方式。传统上，对于一个N级存储元设备，1个存储元存储N位的数据，其中每个位位于N个不同的页面上。例如，在QLC闪存中，1个存储元存储4位信息，每个位位于设备的4个不同页面中。这种方法的缺点是，这4页必须按照一定的顺序进行编程。对于WOM-v代码，我们建议在单个页面中映射代表1个存储元的4位信息。这个映射可以将页面的单个存储元编程为我们选择的电压值。使用这种技术，对于一个WOM-v（2,4），我们将能够将4KB的逻辑页面编码为8KB的数据，并将这些数据存储在闪存的2K个存储元中。类似地，对于一个WOM-v（1,4）代码，1个4KB的逻辑页面将被编码为16KB的数据，并被写入4K存储元。上述方法的含义是，我们不再需要维护页面编程的特定顺序。相反，单个页面上的每个存储元都可以被编程到由写入时存储元代数所决定的特定电压范围。</p>
<blockquote>
<p>一个WOM-v(k,N)方案可以自然地扩展到任何N级存储元，通过将N的值更改为设备的每个存储元的位数。k的值决定了容量和寿命的权衡——较低的k值会产生更高的闪存寿命，但也会消耗更多的物理空间。</p>
</blockquote>
<p><strong>WOM-v优化</strong><br><strong>5. GC_OPT模式：</strong> 解决GC期间有效页面回收带来的<code>写放大问题</code>，进一步提高了SSD的耐久性。关键的观察是，在大多数情况下，如果EU中的无效页面可以被重写，则无需执行擦除。这意味着，在EU不需要擦除的情况下，我们可以保留有效页面，只要我们在未来写入EU时跳过这些有效页面。块中剩余的无效页面将以与以前相同的特定顺序被覆盖，以减少单元间的干扰，并像以前一样在EU的并行单元上条带化写入。<br><strong>6. No_Read(NR)模式：</strong> 由于采用同代转换，在数据写入存储元之前，需要知道存储元的内容，确定其处于哪一代的哪一个电压状态。因此，每次写都需要先读一次。<strong>如何消除写前读</strong>：去掉同代转换，只在GEN之间转换。通过记录当前编程的代数，下一次编程直接跳转到下一代。NR模式可优化性能，但对耐久性有轻微影响。</p>
<h2 id="实验评估"><a href="#实验评估" class="headerlink" title="实验评估"></a>实验评估</h2><p><strong>Micro Benchmarks</strong><br><strong>1. Effect of change in data buffer contents</strong><br><strong><code>由于WOM-v(k,N)码可能发生同代数据转换，因此其收益取决于被覆盖到已有数据块的数据内容。</code></strong><br>在这个微基准测试中，我们按顺序填充设备。一旦设备满，翻转数据缓冲区中所有位的一部分(10%-100%)，然后用修改后的数据再次填充整个设备。重复这一过程多次，并比较随着数据缓冲区内容变化速率的增加而被擦除的EU数量。<br>下图显示了在写入期间因不同数据缓冲区内容而擦除的EU总数。与NO_WOM相比，WOM-v减少了被擦除的EU数量。然而，当后续写入之间的数据变化速率较小时，存储元达到Vmax的速率将会更慢。对于数据变化量较大的工作负载，将更快地达到Vmax，因此EU擦除增益将更低。NO_WOM与数据缓冲区内容无关。</p>
<p><img src="/lv/img/article/WOM-v-FAST/WOM-v-FAST_4.png" alt=""></p>
<p><strong>2. Effect of access pattern</strong><br>为了衡量访问模式的影响，以特定顺序写入来无效先前写入的数据，来产生不同程度的设备写放大。Hot-S是顺序更新数据，Hot-R是随机更新数据，Hot-S和Hot-R下保证所有的页面都是热写的并且垃圾回收中不产生写放大。Cold是只更新一小部分页面，Low-GC和High-GC则产生不同程度的垃圾回收操作。<br>图4-b显示了在不同负载模式下被擦除的EU的数量。WOM-v(2,4)显著减少了被擦除的EU数量。然而，由于GC导致的写放大增加，WOM-v(1,4)的收益不断减少。最后，GC-OPT模式能保持较低的写放大开销。</p>
<p><img src="/lv/img/article/WOM-v-FAST/WOM-v-FAST_5.png" alt=""></p>
<p><strong>Real World Evaluation</strong><br><strong>平台设置</strong><br>FEMU + LightNVM，所有方法下物理空间一样大，并预先填充一半容量的数据。根据负载的footprint设置QLC容量大小。所有WOM-v(2,4)设置的逻辑地址空间是NO_WOM的逻辑地址空间的一半。同样，WOM-v(1,4)设置的逻辑地址空间是NO_WOM的逻辑地址空间的四分之一。</p>
<p><strong>1. Reduction in number of erase operations</strong><br>评估寿命改进情况（以擦除EU的数量进行寿命评估）。首先，WOM-v(2,4)减少EU擦除次数为68%-71%。​针对GC密集型负载（MP-auth和MP-Backend），WOM-v(1,4)的性能不佳。这表明，WOM-v码通过重编程所带来的擦除操作的减少并不能弥补较高速率码所带来的写放大。引入GC_OPT后可以显著降低垃圾回收过程产生的写放大。与NO_WOM相比，WOM-v(2,4)-GC-OPT的擦除次数减少了77-83%，WOM-v(1,4)-GC-OPT减少了82-91%。这意味着在现实负载中，擦除操作减少了4.4-11.1×。​<br>​总之，WOM-v码可以大大减少擦除操作的数量。对于高阶WOM-v以及导致高垃圾回收的工作负载，在垃圾回收期间使用GC_OPT模式来限制写放大是很重要的。</p>
<p><img src="/lv/img/article/WOM-v-FAST/WOM-v-FAST_7.png" alt=""></p>
<p><strong>2. Performance Evaluation</strong><br>评估WOM-v(k,N)对性能的影响。1）由于WOM需要read-before-write来确定当前写的代数，会影响写性能，并提出了WOM-v_NR来优化性能（可能以降低耐久性增益为代价）。2）由于WOM-v(k,N)产生的更高的写入量（写k比特的数据实际写N比特，导致每次写入都要添加额外的(N/k)数据）。</p>
<p><strong>平均性能和吞吐量：</strong> 平均性能/吞吐量比较了NO_WOM与WOM-v(k,N)上运行10个工作负载的累积时间。更大的累积时间意味着更低的系统吞吐量和更高的平均请求延迟。<br>我们观察到，与NO_WOM相比，WOM-v（2,4）的性能开销相当小（需要写前读），在3-8%的范围内。添加NR模式消除了这些性能开销，与NO_WOM差不多。同时，与WOM-v（2,4）相比，启用NR模式对endurance影响不大。<br>同时启用GC_OPT和NR模式大大降低了WOM-v（1,4）方案的性能开销，使性能在NO_WOM的0-8%以内。并且对比NO_WOM显著改善耐久性。</p>
<p><img src="/lv/img/article/WOM-v-FAST/WOM-v-FAST_8.png" alt=""></p>
<p><strong>读尾端延迟：</strong> 评估读取密集型负载的尾端延迟。观察到NO_WOM和WOM-v(k,N)基线编码方案的第95百分位尾端延迟为0.6-7%，并且没有引入较大的尾端延迟。</p>
<p><img src="/lv/img/article/WOM-v-FAST/WOM-v-FAST_9.png" alt=""></p>
<p><strong>对比WOM(2,4)和MLC的耐久性：</strong> QLC的可擦除次数为3K，而MLC为10K。WOM-v(2,4)实际上层是看作MLC来使用的。因此通过比较具有相同逻辑容量和相同物理单元数量的MLC设备和WOM-v(2,4)QLC设备的耐久性。耐久性是在达到最大擦除限制之前可以写入的用户数据量。<br>我们观察到，对于相同的写模式，WOM-QLC设备的耐久性在所有情况下都超过了MLC设备的耐久性（比率大于1）。即使对于具有更高垃圾回收的工作负载，来自WOM代码的改进也低于其他工作负载。平均而言，GC_OPT模式的耐力提高了3.5倍，GC_OPT-NR模式提高了2.4倍。</p>
<p><img src="/lv/img/article/WOM-v-FAST/WOM-v-FAST_10.png" alt=""></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>本文针对下一代高密度闪存提出一种新的编码方案WOM-v，可以有效降低擦除次数，从而改善闪存寿命。对于高写放大的负载，WOM-v码可以通过GC_OPT模式优化；对性能关键型负载，可以采用NR模式进行优化WOM-v使用时的性能问题。另外，WOM-v码本身的写放大问题可能是对空间利用率要求高的SSD所关注的。对于这样的设备，本文建议根据设备的使用情况或工作负载的容量要求，在具有不同码率的WOM-v码之间进行常规转换。WOM-v码可以很容易地扩展到更高密度的未来SSD，如PLC SSD和更复杂的编码方案。</p>
<h2 id="思考"><a href="#思考" class="headerlink" title="思考"></a>思考</h2><p>如果将WOM-v(1,4)应用于QLC(3K P/E，甚至更低)，其总写入量未必能赢过SLC闪存（100K P/E）；WOM-v主要还是针对高密度闪存，例如QLC闪存（其中，QLC可以转换成SLC使用）。</p>
<p><strong>WOM相关文章：</strong></p>
<ul>
<li>Grupp et al. “Characterizing flash memory:Anomalies,observations,and applications.” MICRO’09.</li>
<li>Jagmohan et al. “Write amplification reduction in NAND flash through multi-write coding.” MSST’10</li>
<li>Yaakobi et al. “Error characterization and coding schemes for flash memories.” GLOBECOM’10</li>
<li>Jacobvitz et al. “Writing cosets of a convolutional code to increase the lifetime of flash memory.” Allerton’12</li>
<li>Luojie et al., <a href="https://ieeexplore.ieee.org/document/6503611" target="_blank" rel="noopener">“WOM Codes Reduce Write Amplification in NAND Flash Memory”</a>, GLOBECOM’12</li>
<li>Kaiser et al. “Extending SSD lifetime in database applications with page overwrites.” SYSTOR’13</li>
<li>Berman et al. “Retried-page utilization in write-once-memory a coding perspective.” ISIT’13.</li>
<li>Odeh et al. “NAND flash architectures reducing write amplification through multi-write codes.” MSST’14</li>
<li>Gad et al. “Rewriting flash memories by message passing.” ISIT’15</li>
<li>Yaakobi et al. <a href="https://ieeexplore.ieee.org/document/7282824" target="_blank" rel="noopener">“When_do_WOM_codes_improve_the_erasure_factor_in_flash_memories”</a>, ISIT’15</li>
<li>Margaglia et al.<a href="https://storageconference.us/2015/Papers/05.Margaglia.pdf" target="_blank" rel="noopener">“Improving MLC flash performance and endurance with extended P/E cycles”</a>MSST’15</li>
<li>Yadgar et al. <a href="https://www.usenix.org/conference/fast15/technical-sessions/presentation/yadgar" target="_blank" rel="noopener">“Write Once, Get 50% Free Saving SSD Erase Costs Using WOM Codes”</a>, FAST’15</li>
<li>Margaglia et al. <a href="https://www.usenix.org/conference/fast16/technical-sessions/presentation/margaglia" target="_blank" rel="noopener">“The Devil is in the Details, Implemening Flash Page Reuse with WOM Code”</a>, FAST’16</li>
<li>Yadgar et al. <a href="https://dl.acm.org/doi/10.1145/3177886" target="_blank" rel="noopener">“An Analysis of Flash Page Reuse With WOM Codes”</a>, ToS’18</li>
</ul>

                

                <hr>
                <!-- Pager -->
                <ul class="pager">
                    
                        <li class="previous">
                            <a href="/lv/SSD/HowWriting/" data-toggle="tooltip" data-placement="top" title="如何写学术论文？">&larr; Previous Post</a>
                        </li>
                    
                    
                        <li class="next">
                            <a href="/lv/SSD/WOM系列解读/" data-toggle="tooltip" data-placement="top" title="WOM编码系列解读">Next Post &rarr;</a>
                        </li>
                    
                </ul>

                <br>

                <!--打赏-->
                
                    <div class="reward">
                        <div class="reward-button">赏 <span class="reward-code"> 
                            <span class="alipay-code"> <img class="alipay-img" src="/img/alipay.jpg"><b>支付宝打赏</b></span> 
                            <span class="wechat-code"> <img class="wechat-img" src="/img/wechatpay.jpg"><b>微信打赏</b> </span>
                            </span></div>
                        <p class="reward-notice">good luck!</p>
                    </div>
                
                <!--打赏-->

                <br>
                <!--分享-->
                
                    <div class="social-share"  data-wechat-qrcode-helper="" align="center"></div>
                    <!--  css & js -->
                    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/css/share.min.css">
                    <script src="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/js/social-share.min.js"></script>
                
                <!--分享-->
                <br>                       
                
                <!-- require APlayer -->
                
                <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1.10/dist/APlayer.min.css">
                <script src="https://cdn.jsdelivr.net/npm/aplayer@1.10/dist/APlayer.min.js"></script>
                <script src="https://cdn.jsdelivr.net/npm/meting@1.2/dist/Meting.min.js"></script>

                <div class="aplayer"
                    data-id="2668662377"
                    data-server="netease"
                    data-type="playlist"
                    data-fixed="true" >
                </div>
                

                <!-- duoshuo Share start -->
                
                <!-- 多说 Share end-->

                <!-- 多说评论框 start -->
                
                <!-- 多说评论框 end -->

                <!-- disqus comment start -->
                
                <!-- disqus comment end -->

                
                    <!-- disqus 评论框 start -->
                    <div class="comment">
                        <div id="lv-container" data-id="city" data-uid="MTAyMC8zOTE4NS8xNTcxMg"></div>
                    </div>
                    <!-- disqus 评论框 end -->
                

            </div>
            
            <!-- Tabe of Content -->
            <!-- Table of Contents -->

  
    <style>
      span.toc-nav-number{
        display: none
      }
    </style>
  
    
      <aside id="sidebar">
        <div id="toc" class="toc-article">
        <strong class="toc-title">Contents</strong>
        
          <ol class="toc-nav"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#引子"><span class="toc-nav-number">1.</span> <span class="toc-nav-text"><a href="#&#x5F15;&#x5B50;" class="headerlink" title="&#x5F15;&#x5B50;"></a>&#x5F15;&#x5B50;</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#背景amp问题"><span class="toc-nav-number">2.</span> <span class="toc-nav-text"><a href="#&#x80CC;&#x666F;-amp-&#x95EE;&#x9898;" class="headerlink" title="&#x80CC;&#x666F;&amp;&#x95EE;&#x9898;"></a>&#x80CC;&#x666F;&amp;&#x95EE;&#x9898;</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#binary-wom-codes"><span class="toc-nav-number">2.1.</span> <span class="toc-nav-text"><a href="#Binary-WOM-codes" class="headerlink" title="Binary-WOM codes"></a>Binary-WOM codes</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#wom-v-code"><span class="toc-nav-number">3.</span> <span class="toc-nav-text"><a href="#WOM-v-Code" class="headerlink" title="WOM-v Code"></a>WOM-v Code</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#系统实现"><span class="toc-nav-number">4.</span> <span class="toc-nav-text"><a href="#&#x7CFB;&#x7EDF;&#x5B9E;&#x73B0;" class="headerlink" title="&#x7CFB;&#x7EDF;&#x5B9E;&#x73B0;"></a>&#x7CFB;&#x7EDF;&#x5B9E;&#x73B0;</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#实验评估"><span class="toc-nav-number">5.</span> <span class="toc-nav-text"><a href="#&#x5B9E;&#x9A8C;&#x8BC4;&#x4F30;" class="headerlink" title="&#x5B9E;&#x9A8C;&#x8BC4;&#x4F30;"></a>&#x5B9E;&#x9A8C;&#x8BC4;&#x4F30;</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#总结"><span class="toc-nav-number">6.</span> <span class="toc-nav-text"><a href="#&#x603B;&#x7ED3;" class="headerlink" title="&#x603B;&#x7ED3;"></a>&#x603B;&#x7ED3;</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#思考"><span class="toc-nav-number">7.</span> <span class="toc-nav-text"><a href="#&#x601D;&#x8003;" class="headerlink" title="&#x601D;&#x8003;"></a>&#x601D;&#x8003;</span></a></li></ol>
        
        </div>
      </aside>
    

                
            <!-- Sidebar Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Featured Tags -->
                
                <section>
                    <!-- no hr -->
                    <h5><a href="/lv/tags/">FEATURED TAGS</a></h5>
                    <div class="tags">
                       
                          <a class="tag" href="/lv/tags/#Lifetime" title="Lifetime">Lifetime</a>
                        
                          <a class="tag" href="/lv/tags/#QLC" title="QLC">QLC</a>
                        
                          <a class="tag" href="/lv/tags/#WOM" title="WOM">WOM</a>
                        
                    </div>
                </section>
                

                <!-- Friends Blog -->
                
                <hr>
                <h5>FRIENDS</h5>
                <ul class="list-inline">

                    
                        <li><a href="https://scholar.google.com.hk/citations?user=9F9NYH4AAAAJ&amp;hl=zh-CN" target="_blank">Google Scholar</a></li>
                    
                        <li><a href="https://www.researchgate.net/profile/Yina_Lv" target="_blank">ResearchGate</a></li>
                    
                </ul>
                
            </div>
        </div>
    </div>
</article>






    <!-- 来必力City版公共JS代码 start (一个网页只需插入一次) -->
    <script type="text/javascript">
       (function(d, s) {
           var j, e = d.getElementsByTagName(s)[0];
    
           if (typeof LivereTower === 'function') { return; }
    
           j = d.createElement(s);
           j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
           j.async = true;
    
           e.parentNode.insertBefore(j, e);
       })(document, 'script');
    </script>
    <noscript>为正常使用来必力评论功能请激活JavaScript</noscript>
    <!-- 来必力City版 公共JS代码 end -->



<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>
<!-- anchor-js, Doc:http://bryanbraun.github.io/anchorjs/ -->
<script>
    async("https://cdn.bootcss.com/anchor-js/1.1.1/anchor.min.js",function(){
        anchors.options = {
          visible: 'hover',
          placement: 'left',
          icon: 'ℬ'
        };
        anchors.add().remove('.intro-header h1').remove('.subheading').remove('.sidebar-container h5');
    })
</script>
<style>
    /* place left on bigger screen */
    @media all and (min-width: 800px) {
        .anchorjs-link{
            position: absolute;
            left: -0.75em;
            font-size: 1.1em;
            margin-top : -0.1em;
        }
    }
</style>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=default"></script>


    <!-- Footer -->
    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                
                
                
                    <li>
                        <a target="_blank" href="https://www.zhihu.com/people/mi-tang-gua">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa  fa-stack-1x fa-inverse">知</i>
                            </span>
                        </a>
                    </li>
                

                

                

                
                    <li>
                        <a target="_blank"  href="https://github.com/elainelv">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

   
                <li>
                    <a target="_blank"  href="https://blog.csdn.net/sunshine_lyn">
                        <span class="fa-stack fa-lg">
                            <i class="fa fa-circle fa-stack-2x"></i>
                            <i class="fa fa-book fa-stack-1x fa-inverse"></i>
                        </span>
                    </a>
                </li>
            

                

                </ul>
<script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

                <p class="copyright text-muted">
                    Copyright &copy;  Yina Lv <i class="fa fa-heartbeat"> </i>2023 
                    <br>


<span class="post-count">102.5k words altogether</span>
<i class="fa fa-user-md"></i><span id="busuanzi_container_site_uv">
  visitors: <span id="busuanzi_value_site_uv"></span>
</span>

	
                  <!--   Theme by <a href="http://beantech.org">BeanTech</a> 
                    <span style="display: inline-block; margin: 0 5px;">
                        <i class="fa fa-heart"></i>
                    </span> 
                    re-Ported by <a href="http://www.huweihuang.com">胡伟煌</a> | 
                    <iframe
                        style="margin-left: 2px; margin-bottom:-5px;"
                        frameborder="0" scrolling="0" width="91px" height="20px"
                        src="https://ghbtns.com/github-btn.html?user=huweihuang&repo=hexo-theme-huweihuang&type=star&count=true" >
                    </iframe>
-->


                </p>

            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/lv/js/jquery.min.js"></script>

<!-- Bootstrap Core JavaScript -->
<script src="/lv/js/bootstrap.min.js"></script>

<!-- Custom Theme JavaScript -->
<script src="/lv/js/hux-blog.min.js"></script>


<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>

<!-- 
     Because of the native support for backtick-style fenced code blocks 
     right within the Markdown is landed in Github Pages, 
     From V1.6, There is no need for Highlight.js, 
     so Huxblog drops it officially.

     - https://github.com/blog/2100-github-pages-now-faster-and-simpler-with-jekyll-3-0  
     - https://help.github.com/articles/creating-and-highlighting-code-blocks/    
-->
<!--
    <script>
        async("http://cdn.bootcss.com/highlight.js/8.6/highlight.min.js", function(){
            hljs.initHighlightingOnLoad();
        })
    </script>
    <link href="http://cdn.bootcss.com/highlight.js/8.6/styles/github.min.css" rel="stylesheet">
-->


<!-- jquery.tagcloud.js -->
<script>
    // only load tagcloud.js in tag.html
    if($('#tag_cloud').length !== 0){
        async("http://elainelv.com/lv/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                //size: {start: 1, end: 1, unit: 'em'},
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>

<!--fastClick.js -->
<script>
    async("https://cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>


<!-- Google Analytics -->


<script>
    // dynamic User by Hux
    var _gaId = 'UA-XXXXXXXX-X';
    var _gaDomain = 'yoursite';

    // Originial
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', _gaId, _gaDomain);
    ga('send', 'pageview');
</script>




<!-- Baidu Tongji -->

<script>
    // dynamic User by Hux
    var _baId = 'xxx';

    // Originial
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?" + _baId;
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
</script>






	<a id="rocket" href="#top" class=""></a>
	<script type="text/javascript" src="/js/totop.js?v=1.0.0" async=""></script>
    <script type="text/javascript" src="/js/toc.js?v=1.0.0" async=""></script>
<!-- Image to hack wechat -->
<img src="http://elainelv.com/lv/img/icon_wechat.png" width="0" height="0" />
<!-- Migrate from head to bottom, no longer block render and still work --><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->

</body>

</html>
